import{r as a,a as v,j as e,R as $}from"./app-BhP5LsBi.js";import{N as A,a as K}from"./NavBar-DLZuDC1_.js";import{c as W}from"./checkstatus-Bhh75rH1.js";import{u as Y,P as q}from"./PlaylistDropdown-CxkyEBR7.js";import{N as U,C as u,P as D,L as G}from"./PlatformDropdown-BIZUZDDY.js";import{L as N}from"./loader-circle-DGxwYFzy.js";import{M as Q}from"./music-diwl4NDn.js";import{C as E}from"./circle-check-big-bFzbkAku.js";/* empty css            */import"./createLucideIcon-DXr1tZ9C.js";import"./proxy-Ch-9CurW.js";const ce=()=>{const{conversions:{getConversionHistory:y,invalidateConversionHistory:F}}=Y(),[h,T]=a.useState({}),[L,R]=a.useState(!0),[l,k]=a.useState(""),[p,w]=a.useState(""),[c,f]=a.useState(""),[H,g]=a.useState([]),[I,P]=a.useState(!1),[b,C]=a.useState(!1),[r,j]=a.useState(null),[S,M]=a.useState([]),[_,i]=a.useState(null);a.useEffect(()=>{(async()=>{try{const[s,d]=await Promise.all([W(),y()]);if(s&&s.connected_platforms){T(s.connected_platforms);const o=Object.keys(s.connected_platforms).filter(x=>s.connected_platforms[x]);if(o.length>0){k(o[0]);const x=o.find(z=>z!==o[0]);x&&w(x)}}d.conversions&&M(d.conversions)}catch(s){console.error("Error loading initial data:",s),i("Failed to load initial data")}finally{R(!1)}})()},[y]),a.useEffect(()=>{l&&B(l)},[l]);const B=async t=>{P(!0),i(null);try{const s=await v.get(`/playlists/${t}?limit=50`);g(s.data.data||[])}catch(s){console.error(`Error fetching ${t} playlists:`,s),i(`Failed to fetch ${t} playlists`),g([])}finally{P(!1)}},J=async()=>{if(!l||!p||!c.trim()){i("Please fill in all required fields");return}if(l===p){i("Source and target platforms cannot be the same");return}C(!0),i(null),j(null);try{const t=await v.post("/convert",{source_playlist_id:c.trim(),source_platform:l,target_platform:p});j(t.data.job),O(t.data.job.id),F()}catch(t){console.error("Conversion error:",t);const s=t?.response?.data,d=typeof s=="string"?s:s?.message||"Failed to start conversion";i(d)}finally{C(!1)}},O=async t=>{console.log("Starting to poll conversion status for job ID:",t);const s=async()=>{try{const o=(await v.get(`/convert/${t}`)).data.job;j(o),(o.status==="pending"||o.status==="processing")&&setTimeout(s,1e4)}catch(d){console.error("Error polling conversion status:",d)}};s()},n=t=>{switch(t){case"pending":return{color:"text-yellow-600",icon:N,text:"Pending"};case"processing":return{color:"text-blue-600",icon:N,text:"Processing"};case"completed":return{color:"text-green-600",icon:E,text:"Completed"};case"failed":return{color:"text-red-600",icon:u,text:"Failed"};default:return{color:"text-gray-600",icon:u,text:t}}};if(L)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"})});console.log("Connected platforms----- ",JSON.stringify(h));const m=Object.keys(h).filter(t=>h[t]);return console.log("Connected platforms:",m),e.jsxs(e.Fragment,{children:[e.jsx(A,{items:K}),e.jsxs("div",{className:"w-full max-w-4xl mx-auto p-4 md:p-6",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-purple-600 to-purple-400 bg-clip-text text-transparent",children:"Convert Playlists"}),e.jsx("p",{className:"text-lg text-purple-600/80 dark:text-purple-400/80 font-medium",children:"Convert your playlists between Spotify and YouTube Music"})]}),m.length===0?e.jsx(U,{}):e.jsxs(e.Fragment,{children:[_&&!b&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-700 dark:text-red-300",children:[e.jsx(u,{className:"w-5 h-5"}),e.jsx("span",{children:_})]})}),e.jsxs("div",{className:"bg-white/80 dark:bg-neutral-900/80 backdrop-blur-xl border border-purple-200/50 dark:border-purple-800/50 rounded-2xl p-6 shadow-lg",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-purple-900 dark:text-purple-100 mb-2",children:"Source Platform"}),e.jsx(D,{connectedPlatformKeys:m,selectedPlatform:l,onSelectPlatform:t=>{k(t),f(""),g([])}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-purple-900 dark:text-purple-100 mb-2",children:"Target Platform"}),e.jsx(D,{connectedPlatformKeys:m,selectedPlatform:p,onSelectPlatform:w})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-semibold text-purple-900 dark:text-purple-100 mb-2",children:"Playlist"}),I?e.jsx(G,{}):e.jsxs("div",{className:"space-y-3",children:[e.jsx(q,{playlists:H,selectedPlaylistId:c.startsWith("http")?"":c,onSelectPlaylist:f,placeholder:"Select a playlist"}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"text-purple-600/70 dark:text-purple-400/70 text-sm",children:"or"})}),e.jsx("input",{type:"text",placeholder:"Paste playlist URL (e.g., https://open.spotify.com/playlist/...)",value:c.startsWith("http")?c:"",onChange:t=>f(t.target.value),className:"w-full px-4 py-3 bg-white/60 dark:bg-neutral-800/60 border border-purple-200 dark:border-purple-700 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all "})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:J,disabled:b||!l||!p||!c.trim(),className:"px-8 py-4 bg-gradient-to-r from-purple-600 to-purple-500 text-white font-semibold rounded-xl hover:from-purple-700 hover:to-purple-600 disabled:bg-gray-400 disabled:cursor-not-allowed transition-all duration-200 shadow-lg hover:shadow-xl flex items-center gap-3",children:b?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-5 h-5 animate-spin"}),"Starting Conversion..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-5 h-5"}),"Convert Playlist"]})})})]}),r&&e.jsxs("div",{className:"mt-8 bg-white/80 dark:bg-neutral-900/80 backdrop-blur-xl border border-purple-200/50 dark:border-purple-800/50 rounded-2xl p-6 shadow-lg",children:[e.jsx("h3",{className:"text-xl font-bold text-purple-900 dark:text-purple-100 mb-4",children:"Conversion Status"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-purple-700 dark:text-purple-300",children:"Status:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[$.createElement(n(r.status).icon,{className:`w-5 h-5 ${n(r.status).color} ${r.status==="processing"?"animate-spin":""}`}),e.jsx("span",{className:`font-semibold ${n(r.status).color}`,children:n(r.status).text})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-purple-700 dark:text-purple-300",children:"Source:"}),e.jsxs("span",{className:"text-purple-900 dark:text-purple-100",children:[r.source_playlist.name," (",r.source_playlist.platform,")"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-purple-700 dark:text-purple-300",children:"Target:"}),e.jsx("span",{className:"text-purple-900 dark:text-purple-100 capitalize",children:r.target_platform})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-purple-700 dark:text-purple-300",children:"Progress:"}),e.jsxs("span",{className:"text-purple-900 dark:text-purple-100",children:[r.matched_tracks," / ",r.total_tracks," tracks"]})]}),e.jsx("div",{className:"w-full bg-purple-200 dark:bg-purple-800 rounded-full h-3",children:e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-purple-500 h-3 rounded-full transition-all duration-300",style:{width:`${r.progress_percentage}%`}})}),e.jsxs("div",{className:"text-center text-sm text-purple-600/70 dark:text-purple-400/70",children:[r.progress_percentage,"% complete"]}),r.status==="completed"&&r.target_playlist_id&&e.jsxs("div",{className:"mt-4 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-700 dark:text-green-300",children:[e.jsx(E,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"Conversion completed successfully!"})]}),e.jsxs("p",{className:"text-green-600 dark:text-green-400 text-sm mt-1",children:["Your playlist has been created on ",r.target_platform,"."]})]}),r.status==="failed"&&e.jsxs("div",{className:"mt-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700 dark:text-red-300",children:[e.jsx(u,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"Conversion failed"})]}),e.jsx("p",{className:"text-red-600 dark:text-red-400 text-sm mt-1",children:"There was an error during conversion. Please try again."})]})]})]}),S.length>0&&e.jsxs("div",{className:"mt-8 bg-white/80 dark:bg-neutral-900/80 backdrop-blur-xl border border-purple-200/50 dark:border-purple-800/50 rounded-2xl p-6 shadow-lg",children:[e.jsx("h3",{className:"text-xl font-bold text-purple-900 dark:text-purple-100 mb-4",children:"Conversion History"}),e.jsx("div",{className:"space-y-4",children:S.map(t=>e.jsxs("div",{className:"border border-purple-200/50 dark:border-purple-800/50 rounded-xl p-4 bg-purple-50/50 dark:bg-purple-900/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[$.createElement(n(t.status).icon,{className:`w-4 h-4 ${n(t.status).color} ${t.status==="processing"?"animate-spin":""}`}),e.jsx("span",{className:`font-semibold ${n(t.status).color}`,children:n(t.status).text})]}),e.jsx("span",{className:"text-sm text-purple-600/70 dark:text-purple-400/70",children:new Date(t.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-purple-700 dark:text-purple-300",children:"From:"}),e.jsxs("span",{className:"ml-2 text-purple-900 dark:text-purple-100",children:[t.source_playlist.name," (",t.source_playlist.platform,")"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-purple-700 dark:text-purple-300",children:"To:"}),e.jsx("span",{className:"ml-2 text-purple-900 dark:text-purple-100 capitalize",children:t.target_platform})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-purple-700 dark:text-purple-300",children:"Tracks:"}),e.jsxs("span",{className:"ml-2 text-purple-900 dark:text-purple-100",children:[t.matched_tracks,"/",t.total_tracks]})]})]}),t.status==="completed"&&e.jsx("div",{className:"mt-2 text-sm text-green-600 dark:text-green-400",children:"✓ Conversion completed successfully"}),t.status==="failed"&&e.jsx("div",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:"✗ Conversion failed"})]},t.id))})]})]})]})]})};export{ce as default};
