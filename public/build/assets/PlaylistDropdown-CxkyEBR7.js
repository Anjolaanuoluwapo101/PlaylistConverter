import{r as o,a as i,j as r}from"./app-BhP5LsBi.js";import{b as m}from"./PlatformDropdown-BIZUZDDY.js";class f{cache=new Map;config;constructor(e={ttl:300*1e3}){this.config={maxSize:100,enableLogging:!1,...e}}get(e){const t=this.cache.get(e);return t?Date.now()-t.timestamp>t.ttl?(this.cache.delete(e),this.log(`Cache expired for key: ${e}`),null):(this.log(`Cache hit for key: ${e}`),t.data):(this.log(`Cache miss for key: ${e}`),null)}set(e,t,s){const n=s??this.config.ttl;if(this.config.maxSize&&this.cache.size>=this.config.maxSize){const c=this.cache.keys().next().value;c&&(this.cache.delete(c),this.log(`Cache size limit reached, removed oldest entry: ${c}`))}this.cache.set(e,{data:t,timestamp:Date.now(),ttl:n}),this.log(`Cached data for key: ${e}, TTL: ${n}ms`)}async getOrFetch(e,t,s){const n=this.get(e);if(n!==null)return n;try{const c=await t();return this.set(e,c,s),c}catch(c){throw this.log(`Failed to fetch and cache data for key: ${e}`,c),c}}invalidate(e){this.cache.delete(e)&&this.log(`Invalidated cache for key: ${e}`)}invalidatePattern(e){const t=[];for(const s of this.cache.keys())s.includes(e)&&t.push(s);t.forEach(s=>{this.cache.delete(s),this.log(`Invalidated cache for pattern match: ${s}`)})}clear(){const e=this.cache.size;this.cache.clear(),this.log(`Cleared all cache entries (${e} items)`)}getStats(){return{size:this.cache.size,maxSize:this.config.maxSize,entries:Array.from(this.cache.entries()).map(([e,t])=>({key:e,age:Date.now()-t.timestamp,ttl:t.ttl,expiresIn:t.timestamp+t.ttl-Date.now()}))}}log(e,t){this.config.enableLogging&&(t?console.log(`[ApiCache] ${e}`,t):console.log(`[ApiCache] ${e}`))}}const h=new f({ttl:300*1e3,enableLogging:!1}),p=new f({ttl:300*1e3,enableLogging:!1}),g=new f({ttl:600*1e3,enableLogging:!1}),x=new f({ttl:120*1e3,enableLogging:!1}),u={platforms:a=>`platforms_connected${a?`_${a}`:""}`,playlists:(a,e)=>`playlists_${a}${e?`_${e}`:""}`,playlistTracks:(a,e)=>`tracks_${a}_${e}`,conversionStatus:a=>`conversion_${a}`,conversionHistory:a=>`conversion_history${a?`_${a}`:""}`};function y(){const a=o.useCallback(async()=>h.getOrFetch(u.platforms(),async()=>(await i.get("/platforms/connected")).data),[]),e=o.useCallback(()=>{h.invalidate(u.platforms())},[]);return{getConnectedPlatforms:a,invalidatePlatformCache:e}}function v(){const a=o.useCallback(async s=>p.getOrFetch(u.playlists(s),async()=>(await i.get(`/playlists/${s}`)).data),[]),e=o.useCallback(async(s,n)=>g.getOrFetch(u.playlistTracks(s,n),async()=>(await i.get(`/playlists/${s}/${n}/tracks`)).data),[]),t=o.useCallback(s=>{s?(p.invalidatePattern(s),g.invalidatePattern(s)):(p.clear(),g.clear())},[]);return{getPlaylists:a,getPlaylistTracks:e,invalidatePlaylistCache:t}}function b(){const a=o.useCallback(async s=>(await i.get(`/convert/${s}`)).data,[]),e=o.useCallback(async()=>h.getOrFetch(u.conversionHistory(),async()=>(await i.get("/convert/history")).data),[]),t=o.useCallback(()=>{h.invalidate(u.conversionHistory())},[]);return{getConversionStatus:a,getConversionHistory:e,invalidateConversionHistory:t}}function k(){const a=o.useCallback(async s=>(await i.get(`/sync/${s}`)).data,[]),e=o.useCallback(async()=>h.getOrFetch("sync_history",async()=>(await i.get("/sync/history")).data),[]),t=o.useCallback(()=>{h.invalidate("sync_history")},[]);return{getSyncStatus:a,getSyncHistory:e,invalidateSyncHistory:t}}function $(){const a=y(),e=v(),t=b(),s=k(),n=o.useCallback(()=>{h.clear(),p.clear(),g.clear(),x.clear()},[]);return{platforms:a,playlists:e,conversions:t,syncs:s,clearAllCache:n}}const j=({playlists:a,selectedPlaylistId:e,onSelectPlaylist:t,placeholder:s="Select a playlist"})=>{const[n,c]=o.useState(!1),d=a.find(l=>l.id===e);return r.jsxs("div",{className:"relative",children:[r.jsxs("button",{onClick:()=>c(!n),className:"flex items-center justify-between w-full px-6 py-3 bg-white/80 dark:bg-neutral-900/80 backdrop-blur-xl border border-purple-200/50 dark:border-purple-800/50 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-200 group",children:[r.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[d?.image_url&&r.jsx("img",{src:d.image_url,alt:d.name,className:"w-8 h-8 object-cover rounded"}),r.jsxs("div",{className:"text-left min-w-0 flex-1",children:[r.jsx("span",{className:"font-semibold text-purple-900 dark:text-purple-100 block truncate",children:d?.name||s}),d?.track_count&&r.jsxs("span",{className:"text-sm text-purple-600/70 dark:text-purple-400/70",children:[d.track_count," tracks"]})]})]}),r.jsx(m,{className:`w-4 h-4 text-purple-600 dark:text-purple-400 transition-transform ${n?"rotate-180":""}`})]}),n&&r.jsx("div",{className:"absolute top-full mt-2 w-full bg-white/95 dark:bg-neutral-900/95 backdrop-blur-xl border border-purple-200/50 dark:border-purple-800/50 rounded-2xl shadow-2xl z-50 overflow-hidden max-h-60 overflow-y-auto",children:a.length===0?r.jsx("div",{className:"px-4 py-3 text-purple-600/70 dark:text-purple-400/70 text-center",children:"No playlists available"}):a.map(l=>r.jsxs("button",{onClick:()=>{t(l.id),c(!1)},className:"w-full flex items-center gap-3 px-4 py-3 text-left hover:bg-gradient-to-r hover:from-purple-50 hover:to-purple-100 dark:hover:from-purple-900/50 dark:hover:to-purple-800/50 transition-colors",children:[l.image_url&&r.jsx("img",{src:l.image_url,alt:l.name,className:"w-6 h-6 object-cover rounded"}),r.jsxs("div",{className:"min-w-0 flex-1",children:[r.jsx("span",{className:"font-medium text-purple-900 dark:text-purple-100 block truncate",children:l.name}),r.jsxs("span",{className:"text-sm text-purple-600/70 dark:text-purple-400/70",children:[l.track_count||0," tracks"]})]})]},l.id))})]})};export{j as P,$ as u};
