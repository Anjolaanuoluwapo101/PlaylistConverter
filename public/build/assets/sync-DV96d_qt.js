import{r,a as k,j as e,R as $}from"./app-BhP5LsBi.js";import{N as te,a as se}from"./NavBar-DLZuDC1_.js";import{c as re}from"./checkstatus-Bhh75rH1.js";import{u as ae,P as L}from"./PlaylistDropdown-CxkyEBR7.js";import{N as le,C as g,P as Q,L as z}from"./PlatformDropdown-BIZUZDDY.js";import{L as S}from"./loader-circle-DGxwYFzy.js";import{c as ce}from"./createLucideIcon-DXr1tZ9C.js";import{C as H}from"./circle-check-big-bFzbkAku.js";/* empty css            */import"./music-diwl4NDn.js";import"./proxy-Ch-9CurW.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]],oe=ce("ArrowLeftRight",ne),je=()=>{const{syncs:{getSyncHistory:f},conversions:{getConversionHistory:M}}=ae(),[v,A]=r.useState({}),[O,B]=r.useState(!0),[o,P]=r.useState(""),[i,w]=r.useState(""),[m,_]=r.useState(""),[x,E]=r.useState(""),[K,C]=r.useState([]),[q,F]=r.useState([]),[J,Y]=r.useState(!1),[U,G]=r.useState(!1),[y,D]=r.useState(!1),[n,h]=r.useState(null),[R,b]=r.useState([]),[I,p]=r.useState(null),[j,V]=r.useState(!1),[u,W]=r.useState(!1);r.useEffect(()=>{(async()=>{try{const[s,a]=await Promise.all([re(),f()]);if(s&&s.connected_platforms){A(s.connected_platforms);const l=Object.keys(s.connected_platforms).filter(c=>s.connected_platforms[c]);if(l.length>0){P(l[0]);const c=l.find(ee=>ee!==l[0]);c&&w(c)}}a.syncs&&b(a.syncs)}catch(s){console.error("Error loading initial data:",s),p("Failed to load initial data")}finally{B(!1)}})()},[M]),r.useEffect(()=>{o&&T(o,"source")},[o]),r.useEffect(()=>{i&&T(i,"target")},[i]);const T=async(t,s)=>{const a=s==="source"?Y:G,l=s==="source"?C:F;a(!0),p(null);try{const c=await k.get(`/playlists/${t}?limit=50`);l(c.data.data||[])}catch(c){console.error(`Error fetching ${t} playlists:`,c),p(`Failed to fetch ${t} playlists`),l([])}finally{a(!1)}},X=async()=>{if(!o||!i||!m.trim()||!x.trim()){p("Please fill in all required fields");return}D(!0),p(null),h(null);try{const t=u?"/sync/queued":"/sync",s=await k.post(t,{source_playlist_id:m.trim(),source_platform:o,target_playlist_id:x.trim(),target_platform:i,remove_extras:j});if(u){const a={id:s.data.job_id,status:"pending",source_playlist_id:m.trim(),target_playlist_id:x.trim(),source_platform:o,target_platform:i,remove_extras:j,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};h(a),Z(a.id)}else{h(s.data.job);const a=await f();a.syncs&&b(a.syncs)}}catch(t){console.error("Sync error:",t);const s=t?.response?.data,a=typeof s=="string"?s:s?.message||"Failed to start sync";p(a)}finally{D(!1)}},Z=async t=>{console.log("Starting to poll sync status for job ID:",t);const s=async()=>{try{const l=(await k.get(`/sync/status/${t}`)).data.job;if(h(l),l.status==="pending"||l.status==="processing")setTimeout(s,1e4);else{const c=await f();c.syncs&&b(c.syncs)}}catch(a){console.error("Error polling sync status:",a);const l=a?.response?.data,c=typeof l=="string"?l:l?.message||"Failed to poll sync status";p(c)}};s()},d=t=>{switch(t){case"pending":return{color:"text-yellow-600",icon:S,text:"Pending"};case"processing":return{color:"text-blue-600",icon:S,text:"Processing"};case"completed":return{color:"text-green-600",icon:H,text:"Completed"};case"failed":return{color:"text-red-600",icon:g,text:"Failed"};default:return{color:"text-gray-600",icon:g,text:t}}};if(O)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"})});const N=Object.keys(v).filter(t=>v[t]);return e.jsxs(e.Fragment,{children:[e.jsx(te,{items:se}),e.jsxs("div",{className:"w-full max-w-4xl mx-auto p-4 md:p-6",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-purple-600 to-purple-400 bg-clip-text text-transparent",children:"Sync Playlists"}),e.jsx("p",{className:"text-lg text-purple-600/80 dark:text-purple-400/80 font-medium",children:"Keep your playlists synchronized across platforms"})]}),N.length===0?e.jsx(le,{}):e.jsxs(e.Fragment,{children:[I&&!y&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-700 dark:text-red-300",children:[e.jsx(g,{className:"w-5 h-5"}),e.jsx("span",{children:I})]})}),e.jsxs("div",{className:"bg-white/80 dark:bg-neutral-900/80 backdrop-blur-xl border border-purple-200/50 dark:border-purple-800/50 rounded-2xl p-6 shadow-lg",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-purple-900 dark:text-purple-100 mb-2",children:"Source Platform"}),e.jsx(Q,{connectedPlatformKeys:N,selectedPlatform:o,onSelectPlatform:t=>{P(t),_(""),C([])}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-purple-900 dark:text-purple-100 mb-2",children:"Target Platform"}),e.jsx(Q,{connectedPlatformKeys:N,selectedPlatform:i,onSelectPlatform:t=>{w(t),E(""),F([])}})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-purple-900 dark:text-purple-100 mb-2",children:"Source Playlist"}),J?e.jsx(z,{}):e.jsx(L,{playlists:K,selectedPlaylistId:m,onSelectPlaylist:_,placeholder:"Select source playlist"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-purple-900 dark:text-purple-100 mb-2",children:"Target Playlist"}),U?e.jsx(z,{}):e.jsx(L,{playlists:q,selectedPlaylistId:x,onSelectPlaylist:E,placeholder:"Select target playlist"})]})]}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"removeExtras",checked:j,onChange:t=>V(t.target.checked),className:"w-4 h-4 text-purple-600 bg-gray-100 border-gray-300 rounded focus:ring-purple-500"}),e.jsx("label",{htmlFor:"removeExtras",className:"text-sm font-medium text-purple-900 dark:text-purple-100",children:"Remove tracks from target playlist that are not in source playlist"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"useQueue",checked:u,onChange:t=>W(t.target.checked),className:"w-4 h-4 text-purple-600 bg-gray-100 border-gray-300 rounded focus:ring-purple-500"}),e.jsx("label",{htmlFor:"useQueue",className:"text-sm font-medium text-purple-900 dark:text-purple-100",children:"Queue sync for background processing (recommended for large playlists)"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:X,disabled:y||!o||!i||!m.trim()||!x.trim(),className:"px-8 py-4 bg-gradient-to-r from-purple-600 to-purple-500 text-white font-semibold rounded-xl hover:from-purple-700 hover:to-purple-600 disabled:bg-gray-400 disabled:cursor-not-allowed transition-all duration-200 shadow-lg hover:shadow-xl flex items-center gap-3",children:y?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-5 h-5 animate-spin"}),u?"Queueing Sync...":"Syncing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-5 h-5"}),u?"Queue Sync":"Sync Now"]})})})]}),n&&e.jsxs("div",{className:"mt-8 bg-white/80 dark:bg-neutral-900/80 backdrop-blur-xl border border-purple-200/50 dark:border-purple-800/50 rounded-2xl p-6 shadow-lg",children:[e.jsx("h3",{className:"text-xl font-bold text-purple-900 dark:text-purple-100 mb-4",children:"Sync Status"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-purple-700 dark:text-purple-300",children:"Status:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[$.createElement(d(n.status).icon,{className:`w-5 h-5 ${d(n.status).color} ${n.status==="processing"?"animate-spin":""}`}),e.jsx("span",{className:`font-semibold ${d(n.status).color}`,children:d(n.status).text})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-purple-700 dark:text-purple-300",children:"Source:"}),e.jsx("span",{className:"text-purple-900 dark:text-purple-100 capitalize",children:n.source_platform})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-purple-700 dark:text-purple-300",children:"Target:"}),e.jsx("span",{className:"text-purple-900 dark:text-purple-100 capitalize",children:n.target_platform})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-purple-700 dark:text-purple-300",children:"Remove Extras:"}),e.jsx("span",{className:"text-purple-900 dark:text-purple-100",children:n.remove_extras?"Yes":"No"})]}),n.status==="completed"&&e.jsxs("div",{className:"mt-4 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-700 dark:text-green-300",children:[e.jsx(H,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"Sync completed successfully!"})]}),e.jsx("p",{className:"text-green-600 dark:text-green-400 text-sm mt-1",children:"Your playlists have been synchronized."})]}),n.status==="failed"&&e.jsxs("div",{className:"mt-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700 dark:text-red-300",children:[e.jsx(g,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"Sync failed"})]}),e.jsx("p",{className:"text-red-600 dark:text-red-400 text-sm mt-1",children:"There was an error during sync. Please try again."})]})]})]}),R.length>0&&e.jsxs("div",{className:"mt-8 bg-white/80 dark:bg-neutral-900/80 backdrop-blur-xl border border-purple-200/50 dark:border-purple-800/50 rounded-2xl p-6 shadow-lg",children:[e.jsx("h3",{className:"text-xl font-bold text-purple-900 dark:text-purple-100 mb-4",children:"Sync History"}),e.jsx("div",{className:"space-y-4",children:R.slice(0,10).map(t=>e.jsxs("div",{className:"border border-purple-200/50 dark:border-purple-800/50 rounded-xl p-4 bg-purple-50/50 dark:bg-purple-900/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[$.createElement(d(t.status).icon,{className:`w-4 h-4 ${d(t.status).color} ${t.status==="processing"?"animate-spin":""}`}),e.jsx("span",{className:`font-semibold ${d(t.status).color}`,children:d(t.status).text})]}),e.jsx("span",{className:"text-sm text-purple-600/70 dark:text-purple-400/70",children:new Date(t.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-purple-700 dark:text-purple-300",children:"From:"}),e.jsx("span",{className:"ml-2 text-purple-900 dark:text-purple-100 capitalize",children:t.source_platform})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-purple-700 dark:text-purple-300",children:"To:"}),e.jsx("span",{className:"ml-2 text-purple-900 dark:text-purple-100 capitalize",children:t.target_platform})]})]}),t.status==="completed"&&e.jsx("div",{className:"mt-2 text-sm text-green-600 dark:text-green-400",children:"✓ Sync completed successfully"}),t.status==="failed"&&e.jsx("div",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:"✗ Sync failed"})]},t.id))})]})]})]})]})};export{je as default};
